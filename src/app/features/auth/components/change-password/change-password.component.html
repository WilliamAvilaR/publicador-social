<div class="change-password-wrapper" [class.embedded]="embedded">
  <div class="change-password-panel" [class.embedded-panel]="embedded">
    <div class="header" *ngIf="!embedded">
      <h2 class="title">Cambiar Contraseña</h2>
      <p class="subtitle">Ingresa tu contraseña actual y la nueva contraseña</p>
    </div>

    <!-- Mensaje de éxito -->
    <div *ngIf="successMessage" class="success-message">
      <svg class="success-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <polyline points="22 4 12 14.01 9 11.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <div class="success-content">
        <strong>¡Éxito!</strong>
        <p>{{ successMessage }}</p>
      </div>
    </div>

    <!-- Mensaje de error -->
    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
    </div>

    <form [formGroup]="changePasswordForm" (ngSubmit)="onSubmit()" class="change-password-form">
      <!-- Contraseña Actual -->
      <div class="input-group">
        <svg class="input-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="3" y="11" width="18" height="11" rx="2" ry="2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M7 11V7C7 5.67392 7.52678 4.40215 8.46447 3.46447C9.40215 2.52678 10.6739 2 12 2C13.3261 2 14.5979 2.52678 15.5355 3.46447C16.4732 4.40215 17 5.67392 17 7V11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <input 
          [type]="showCurrentPassword ? 'text' : 'password'" 
          formControlName="currentPassword"
          placeholder="Contraseña actual" 
          class="input-field"
          [class.invalid]="isFieldInvalid('currentPassword')"
        />
        <button type="button" class="toggle-password" (click)="toggleCurrentPassword()">
          <svg *ngIf="!showCurrentPassword" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M1 12S5 4 12 4S23 12 23 12S19 20 12 20S1 12 1 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <svg *ngIf="showCurrentPassword" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20C7 20 2.73 16.39 1 12C2.73 7.61 7 4 12 4C16.39 4 20.73 7.61 22 12C21.27 14.39 19.94 16.39 17.94 17.94Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M1 1L23 23" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M9 9C9.53043 8.39993 10.2342 7.99995 11 7.99995C11.7658 7.99995 12.4696 8.39993 13 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M15 15C14.4696 15.6001 13.7658 16 13 16C12.2342 16 11.5304 15.6001 11 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <div *ngIf="isFieldInvalid('currentPassword')" class="field-error">
          {{ getFieldError('currentPassword') }}
        </div>
      </div>

      <!-- Nueva Contraseña -->
      <div class="input-group">
        <svg class="input-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="3" y="11" width="18" height="11" rx="2" ry="2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M7 11V7C7 5.67392 7.52678 4.40215 8.46447 3.46447C9.40215 2.52678 10.6739 2 12 2C13.3261 2 14.5979 2.52678 15.5355 3.46447C16.4732 4.40215 17 5.67392 17 7V11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <input 
          [type]="showNewPassword ? 'text' : 'password'" 
          formControlName="newPassword"
          placeholder="Nueva contraseña" 
          class="input-field"
          [class.invalid]="isFieldInvalid('newPassword')"
        />
        <button type="button" class="toggle-password" (click)="toggleNewPassword()">
          <svg *ngIf="!showNewPassword" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M1 12S5 4 12 4S23 12 23 12S19 20 12 20S1 12 1 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <svg *ngIf="showNewPassword" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20C7 20 2.73 16.39 1 12C2.73 7.61 7 4 12 4C16.39 4 20.73 7.61 22 12C21.27 14.39 19.94 16.39 17.94 17.94Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M1 1L23 23" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M9 9C9.53043 8.39993 10.2342 7.99995 11 7.99995C11.7658 7.99995 12.4696 8.39993 13 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M15 15C14.4696 15.6001 13.7658 16 13 16C12.2342 16 11.5304 15.6001 11 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <div *ngIf="isFieldInvalid('newPassword')" class="field-error">
          {{ getFieldError('newPassword') }}
        </div>
      </div>

      <!-- Confirmar Nueva Contraseña -->
      <div class="input-group">
        <svg class="input-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="3" y="11" width="18" height="11" rx="2" ry="2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M7 11V7C7 5.67392 7.52678 4.40215 8.46447 3.46447C9.40215 2.52678 10.6739 2 12 2C13.3261 2 14.5979 2.52678 15.5355 3.46447C16.4732 4.40215 17 5.67392 17 7V11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <input 
          [type]="showConfirmPassword ? 'text' : 'password'" 
          formControlName="confirmNewPassword"
          placeholder="Confirmar nueva contraseña" 
          class="input-field"
          [class.invalid]="isFieldInvalid('confirmNewPassword')"
        />
        <button type="button" class="toggle-password" (click)="toggleConfirmPassword()">
          <svg *ngIf="!showConfirmPassword" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M1 12S5 4 12 4S23 12 23 12S19 20 12 20S1 12 1 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <svg *ngIf="showConfirmPassword" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20C7 20 2.73 16.39 1 12C2.73 7.61 7 4 12 4C16.39 4 20.73 7.61 22 12C21.27 14.39 19.94 16.39 17.94 17.94Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M1 1L23 23" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M9 9C9.53043 8.39993 10.2342 7.99995 11 7.99995C11.7658 7.99995 12.4696 8.39993 13 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M15 15C14.4696 15.6001 13.7658 16 13 16C12.2342 16 11.5304 15.6001 11 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <div *ngIf="isFieldInvalid('confirmNewPassword')" class="field-error">
          {{ getFieldError('confirmNewPassword') }}
        </div>
      </div>

      <div class="form-actions">
        <button *ngIf="!embedded" type="button" class="cancel-button" (click)="onCancel()" [disabled]="isLoading">
          Cancelar
        </button>
        <button type="submit" class="submit-button" [disabled]="isLoading">
          <span *ngIf="!isLoading">Cambiar Contraseña</span>
          <span *ngIf="isLoading">Cambiando...</span>
        </button>
      </div>
    </form>
  </div>
</div>
