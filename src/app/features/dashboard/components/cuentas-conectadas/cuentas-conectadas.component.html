<div class="cuentas-container">
  <div class="header-section">
    <h1>Cuentas Conectadas</h1>
    <p>Gestiona tus cuentas de redes sociales conectadas</p>
  </div>

  <div class="connect-section">
    <div class="connect-card">
      <div class="connect-header">
        <div class="platform-info">
          <svg class="platform-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
          </svg>
          <div>
            <h2>Facebook</h2>
            <p>Conecta tu cuenta de Facebook para publicar en tus páginas</p>
          </div>
        </div>
        <app-facebook-connect></app-facebook-connect>
      </div>
    </div>
  </div>

  <div class="pages-section">
    <h2>Páginas Conectadas</h2>
    
    <div *ngIf="loading" class="loading-state">
      <div class="spinner"></div>
      <p>Cargando páginas...</p>
    </div>

    <div *ngIf="!loading && error" class="error-state">
      <p>{{ error }}</p>
      <button (click)="loadConnectedPages()" class="retry-btn">Reintentar</button>
    </div>

    <div *ngIf="!loading && !error && pages.length === 0" class="empty-state">
      <svg class="empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/>
      </svg>
      <p>No hay páginas conectadas</p>
      <p class="empty-subtitle">Conecta tu cuenta de Facebook para ver tus páginas aquí</p>
    </div>

    <div *ngIf="!loading && !error && pages.length > 0" class="pages-grid">
      <div *ngFor="let page of pages" class="page-card" [class.inactive]="!page.isActive">
        <div class="page-header">
          <div class="page-icon">
            <img 
              *ngIf="page.pictureUrl && !hasImageError(page.facebookPageId)" 
              [src]="page.pictureUrl!" 
              [alt]="page.name"
              class="page-avatar"
              (error)="onImageError(page.facebookPageId)">
            <svg 
              *ngIf="!page.pictureUrl || hasImageError(page.facebookPageId)"
              viewBox="0 0 24 24" 
              fill="currentColor"
              class="page-icon-svg">
              <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
            </svg>
          </div>
          <div class="page-info">
            <h3>{{ page.name }}</h3>
            <p class="page-id">ID: {{ page.facebookPageId }}</p>
          </div>
          <div class="page-status">
            <label class="status-toggle">
              <input 
                type="checkbox" 
                [checked]="page.isActive"
                [disabled]="isUpdatingStatus(page.facebookPageId)"
                (change)="updatePageStatus(page, $any($event.target).checked)"
                class="toggle-input">
              <span class="toggle-slider" [class.updating]="isUpdatingStatus(page.facebookPageId)"></span>
              <span class="status-label">
                {{ isUpdatingStatus(page.facebookPageId) ? 'Actualizando...' : (page.isActive ? 'Activa' : 'Inactiva') }}
              </span>
            </label>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Sección de Grupos de Facebook -->
  <div class="groups-section">
    <div class="groups-header">
      <h2>Grupos de Facebook</h2>
      <button 
        class="add-group-btn"
        (click)="toggleAddGroupForm()"
        [class.active]="showAddGroupForm">
        <span *ngIf="!showAddGroupForm">+</span>
        <span *ngIf="showAddGroupForm">×</span>
        {{ showAddGroupForm ? 'Cancelar' : 'Agregar Grupo' }}
      </button>
    </div>

    <!-- Formulario para agregar grupo -->
    <div *ngIf="showAddGroupForm" class="add-group-form">
      <div class="form-group">
        <label for="groupUrl">URL del Grupo de Facebook</label>
        <input 
          type="text" 
          id="groupUrl"
          [(ngModel)]="groupUrl"
          placeholder="https://www.facebook.com/groups/123456789"
          class="group-url-input"
          [disabled]="addingGroup">
        <p class="form-help">Ingresa la URL completa del grupo de Facebook que deseas agregar</p>
      </div>
      <div class="form-actions">
        <button 
          class="btn-primary"
          (click)="addGroup()"
          [disabled]="addingGroup || !groupUrl.trim()">
          <span *ngIf="addingGroup" class="spinner-small"></span>
          {{ addingGroup ? 'Agregando...' : 'Agregar Grupo' }}
        </button>
        <button 
          class="btn-secondary"
          (click)="toggleAddGroupForm()"
          [disabled]="addingGroup">
          Cancelar
        </button>
      </div>
    </div>
    
    <div *ngIf="loadingGroups" class="loading-state">
      <div class="spinner"></div>
      <p>Cargando grupos...</p>
    </div>

    <div *ngIf="!loadingGroups && groupsError" class="error-state">
      <p>{{ groupsError }}</p>
      <button (click)="loadGroups()" class="retry-btn">Reintentar</button>
    </div>

    <div *ngIf="!loadingGroups && !groupsError && groups.length === 0" class="empty-state">
      <svg class="empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
      </svg>
      <p>No hay grupos conectados</p>
      <p class="empty-subtitle">Agrega grupos de Facebook usando el botón de arriba</p>
    </div>

    <div *ngIf="!loadingGroups && !groupsError && groups.length > 0" class="groups-grid">
      <div *ngFor="let group of groups" class="group-card" [class.inactive]="!group.isActive">
        <div class="group-header">
          <div class="group-icon">
            <img 
              *ngIf="group.pictureUrl && !hasGroupImageError(group.id)" 
              [src]="group.pictureUrl" 
              [alt]="group.name"
              class="group-avatar"
              (error)="onGroupImageError(group.id)">
            <svg 
              *ngIf="!group.pictureUrl || hasGroupImageError(group.id)"
              viewBox="0 0 24 24" 
              fill="currentColor"
              class="group-icon-svg">
              <path d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
            </svg>
          </div>
          <div class="group-info">
            <h3>{{ group.name }}</h3>
            <p class="group-id">ID: {{ group.facebookGroupId }}</p>
            <p class="group-url" *ngIf="group.originalUrl">
              <a [href]="group.originalUrl" target="_blank" rel="noopener noreferrer">
                Ver en Facebook
              </a>
            </p>
          </div>
          <div class="group-status">
            <label class="status-toggle">
              <input 
                type="checkbox" 
                [checked]="group.isActive"
                [disabled]="isUpdatingGroupStatus(group.facebookGroupId)"
                (change)="updateGroupStatus(group, $any($event.target).checked)"
                class="toggle-input">
              <span class="toggle-slider" [class.updating]="isUpdatingGroupStatus(group.facebookGroupId)"></span>
              <span class="status-label">
                {{ isUpdatingGroupStatus(group.facebookGroupId) ? 'Actualizando...' : (group.isActive ? 'Activo' : 'Inactivo') }}
              </span>
            </label>
          </div>
        </div>
        <div class="group-meta" *ngIf="group.lastSyncedAt">
          <p class="meta-text">
            Última sincronización: {{ getTimeAgo(group.lastSyncedAt) }}
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
